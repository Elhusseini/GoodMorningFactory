<!-- UI/Views/ReportsView.xaml -->
<!-- *** تحديث: تمت إضافة قسم تقرير الهدر *** -->
<UserControl x:Class="GoodMorningFactory.UI.Views.ReportsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900"
             Background="#F5F5F5" FlowDirection="RightToLeft">
    <Grid Margin="10">
        <TabControl>
            <!-- التبويب الأول: تقرير المبيعات -->
            <TabItem Header="تقرير المبيعات" FontSize="14">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                        <Label Content="من تاريخ:" VerticalAlignment="Center"/>
                        <DatePicker x:Name="SalesFromDatePicker" Width="150" VerticalAlignment="Center"/>
                        <Label Content="إلى تاريخ:" VerticalAlignment="Center" Margin="20,0,0,0"/>
                        <DatePicker x:Name="SalesToDatePicker" Width="150" VerticalAlignment="Center"/>
                        <Button x:Name="GenerateSalesReportButton" Content="📊 توليد تقرير المبيعات" Margin="20,0,0,0" Padding="10,5" Click="GenerateSalesReportButton_Click"/>
                        <Button x:Name="ExportSalesToPdfButton" Content="🖨️ تصدير إلى PDF" Margin="10,0,0,0" Padding="10,5" Click="ExportSalesToPdfButton_Click"/>
                    </StackPanel>

                    <DataGrid x:Name="SalesReportDataGrid" Grid.Row="1" Margin="5"
                              IsReadOnly="True" AutoGenerateColumns="False" CanUserAddRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="رقم الفاتورة" Binding="{Binding InvoiceNumber}" Width="*"/>
                            <DataGridTextColumn Header="تاريخ البيع" Binding="{Binding SaleDate, StringFormat={}{0:g}}" Width="*"/>
                            <DataGridTextColumn Header="إجمالي المبلغ" Binding="{Binding TotalAmount, StringFormat={}{0:C}}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                        <TextBlock Text="إجمالي المبيعات في الفترة المحددة:" FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock x:Name="TotalSalesTextBlock" Text="0.00" FontWeight="Bold" FontSize="16" Foreground="Green" Margin="10,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- التبويب الثاني: تقرير المشتريات -->
            <TabItem Header="تقرير المشتريات" FontSize="14">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                        <Label Content="من تاريخ:" VerticalAlignment="Center"/>
                        <DatePicker x:Name="PurchasesFromDatePicker" Width="150" VerticalAlignment="Center"/>
                        <Label Content="إلى تاريخ:" VerticalAlignment="Center" Margin="20,0,0,0"/>
                        <DatePicker x:Name="PurchasesToDatePicker" Width="150" VerticalAlignment="Center"/>
                        <Button x:Name="GeneratePurchasesReportButton" Content="📊 توليد تقرير المشتريات" Margin="20,0,0,0" Padding="10,5" Click="GeneratePurchasesReportButton_Click"/>
                        <Button x:Name="ExportPurchasesToPdfButton" Content="🖨️ تصدير إلى PDF" Margin="10,0,0,0" Padding="10,5" Click="ExportPurchasesToPdfButton_Click"/>
                    </StackPanel>

                    <DataGrid x:Name="PurchasesReportDataGrid" Grid.Row="1" Margin="5"
                              IsReadOnly="True" AutoGenerateColumns="False" CanUserAddRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="رقم الفاتورة" Binding="{Binding InvoiceNumber}" Width="*"/>
                            <DataGridTextColumn Header="المورد" Binding="{Binding Supplier.Name}" Width="*"/>
                            <DataGridTextColumn Header="تاريخ الشراء" Binding="{Binding PurchaseDate, StringFormat={}{0:d}}" Width="*"/>
                            <DataGridTextColumn Header="إجمالي المبلغ" Binding="{Binding TotalAmount, StringFormat={}{0:C}}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                        <TextBlock Text="إجمالي المشتريات في الفترة المحددة:" FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock x:Name="TotalPurchasesTextBlock" Text="0.00" FontWeight="Bold" FontSize="16" Foreground="Blue" Margin="10,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- التبويب الثالث: تقرير حالة المخزون -->
            <TabItem Header="تقرير حالة المخزون" FontSize="14">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Button x:Name="ExportInventoryToPdfButton" Content="🖨️ تصدير إلى PDF" Grid.Row="0" HorizontalAlignment="Left" Margin="5" Padding="10,5" Click="ExportInventoryToPdfButton_Click"/>
                    <DataGrid x:Name="InventoryReportDataGrid" Grid.Row="1" Margin="5"
                          IsReadOnly="True" AutoGenerateColumns="False" CanUserAddRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="كود المنتج" Binding="{Binding ProductCode}" Width="*"/>
                            <DataGridTextColumn Header="اسم المنتج" Binding="{Binding ProductName}" Width="2*"/>
                            <DataGridTextColumn Header="التصنيف" Binding="{Binding CategoryName}" Width="*"/>
                            <DataGridTextColumn Header="الكمية الحالية" Binding="{Binding Quantity}" Width="*" FontWeight="Bold"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- التبويب الرابع: تقارير الإنتاج -->
            <TabItem Header="تقارير الإنتاج" FontSize="14">
                <TabControl>
                    <TabItem Header="حالة أوامر العمل">
                        <GroupBox Header="تقرير حالة أوامر العمل" Margin="5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                    <Label Content="الحالة:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="WoStatusFilterComboBox" Width="150" VerticalAlignment="Center"/>
                                    <Label Content="من تاريخ (البدء المخطط):" VerticalAlignment="Center" Margin="20,0,0,0"/>
                                    <DatePicker x:Name="WoFromDatePicker" Width="120" VerticalAlignment="Center"/>
                                    <Label Content="إلى تاريخ:" VerticalAlignment="Center" Margin="20,0,0,0"/>
                                    <DatePicker x:Name="WoToDatePicker" Width="120" VerticalAlignment="Center"/>
                                    <Button x:Name="GenerateWoReportButton" Content="📊 توليد التقرير" Margin="20,0,0,0" Padding="10,5" Click="GenerateWoReportButton_Click"/>
                                </StackPanel>

                                <DataGrid x:Name="WoReportDataGrid" Grid.Row="1" Margin="5" IsReadOnly="True" AutoGenerateColumns="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="رقم الأمر" Binding="{Binding WorkOrderNumber}" Width="*"/>
                                        <DataGridTextColumn Header="المنتج" Binding="{Binding FinishedGood.Name}" Width="2*"/>
                                        <DataGridTextColumn Header="الكمية المطلوبة" Binding="{Binding QuantityToProduce}" Width="*"/>
                                        <DataGridTextColumn Header="الكمية المنتجة" Binding="{Binding QuantityProduced}" Width="*"/>
                                        <DataGridTextColumn Header="تاريخ البدء الفعلي" Binding="{Binding ActualStartDate, StringFormat='d'}" Width="*"/>
                                        <DataGridTextColumn Header="تاريخ الانتهاء الفعلي" Binding="{Binding ActualEndDate, StringFormat='d'}" Width="*"/>
                                        <DataGridTextColumn Header="الحالة" Binding="{Binding Status}" Width="*" FontWeight="Bold"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </GroupBox>
                    </TabItem>
                    <TabItem Header="تكلفة الإنتاج">
                        <GroupBox Header="تقرير تكلفة الإنتاج" Margin="5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                    <Label Content="من تاريخ (الانتهاء الفعلي):" VerticalAlignment="Center"/>
                                    <DatePicker x:Name="PcFromDatePicker" Width="150" VerticalAlignment="Center"/>
                                    <Label Content="إلى تاريخ:" VerticalAlignment="Center" Margin="20,0,0,0"/>
                                    <DatePicker x:Name="PcToDatePicker" Width="150" VerticalAlignment="Center"/>
                                    <Button x:Name="GeneratePcReportButton" Content="📊 توليد التقرير" Margin="20,0,0,0" Padding="10,5" Click="GeneratePcReportButton_Click"/>
                                </StackPanel>

                                <DataGrid x:Name="PcReportDataGrid" Grid.Row="1" Margin="5" IsReadOnly="True" AutoGenerateColumns="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="رقم أمر العمل" Binding="{Binding WorkOrderNumber}" Width="*"/>
                                        <DataGridTextColumn Header="المنتج" Binding="{Binding ProductName}" Width="2*"/>
                                        <DataGridTextColumn Header="الكمية المنتجة" Binding="{Binding ProducedQuantity}" Width="*"/>
                                        <DataGridTextColumn Header="تاريخ الانتهاء" Binding="{Binding CompletionDate, StringFormat='d'}" Width="*"/>
                                        <DataGridTextColumn Header="تكلفة المواد الإجمالية" Binding="{Binding TotalMaterialCost, StringFormat=C}" Width="*" FontWeight="Bold"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </GroupBox>
                    </TabItem>
                    <TabItem Header="تحليل استهلاك المواد">
                        <GroupBox Header="تقرير تحليل استهلاك المواد لأمر عمل" Margin="5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                    <Label Content="اختر أمر العمل (المكتمل):" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="McWorkOrderComboBox" Width="300" VerticalAlignment="Center" DisplayMemberPath="WorkOrderNumber" SelectedValuePath="Id" SelectionChanged="McWorkOrderComboBox_SelectionChanged"/>
                                </StackPanel>

                                <DataGrid x:Name="McReportDataGrid" Grid.Row="1" Margin="5" IsReadOnly="True" AutoGenerateColumns="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="المادة الخام" Binding="{Binding MaterialName}" Width="2*"/>
                                        <DataGridTextColumn Header="الكمية المخططة" Binding="{Binding PlannedQuantity, StringFormat=N4}" Width="*"/>
                                        <DataGridTextColumn Header="الكمية الفعلية" Binding="{Binding ActualQuantity, StringFormat=N4}" Width="*"/>
                                        <DataGridTextColumn Header="الفرق (الهدر/الوفر)" Binding="{Binding Variance, StringFormat=N4}" Width="*" FontWeight="Bold"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </GroupBox>
                    </TabItem>
                    <!-- *** بداية التحديث: إضافة قسم جديد *** -->
                    <TabItem Header="كفاءة الإنتاج">
                        <GroupBox Header="تقرير تحليل كفاءة الإنتاج" Margin="5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                    <Label Content="من تاريخ (الانتهاء الفعلي):" VerticalAlignment="Center"/>
                                    <DatePicker x:Name="EffFromDatePicker" Width="150" VerticalAlignment="Center"/>
                                    <Label Content="إلى تاريخ:" VerticalAlignment="Center" Margin="20,0,0,0"/>
                                    <DatePicker x:Name="EffToDatePicker" Width="150" VerticalAlignment="Center"/>
                                    <Button x:Name="GenerateEffReportButton" Content="📊 توليد التقرير" Margin="20,0,0,0" Padding="10,5" Click="GenerateEffReportButton_Click"/>
                                </StackPanel>

                                <DataGrid x:Name="EffReportDataGrid" Grid.Row="1" Margin="5" IsReadOnly="True" AutoGenerateColumns="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="رقم أمر العمل" Binding="{Binding WorkOrderNumber}" Width="*"/>
                                        <DataGridTextColumn Header="المنتج" Binding="{Binding ProductName}" Width="2*"/>
                                        <DataGridTextColumn Header="المدة المخططة (أيام)" Binding="{Binding PlannedDurationDays, StringFormat=N1}" Width="*"/>
                                        <DataGridTextColumn Header="المدة الفعلية (أيام)" Binding="{Binding ActualDurationDays, StringFormat=N1}" Width="*"/>
                                        <DataGridTextColumn Header="الكفاءة" Binding="{Binding Efficiency}" Width="*" FontWeight="Bold"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </GroupBox>
                    </TabItem>
                    <!-- *** بداية التحديث: إضافة قسم جديد *** -->
                    <TabItem Header="تقرير الهدر">
                        <GroupBox Header="تقرير تحليل الهدر في الإنتاج" Margin="5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                    <Label Content="من تاريخ:" VerticalAlignment="Center"/>
                                    <DatePicker x:Name="ScrapFromDatePicker" Width="150" VerticalAlignment="Center"/>
                                    <Label Content="إلى تاريخ:" VerticalAlignment="Center" Margin="20,0,0,0"/>
                                    <DatePicker x:Name="ScrapToDatePicker" Width="150" VerticalAlignment="Center"/>
                                    <Button x:Name="GenerateScrapReportButton" Content="📊 توليد التقرير" Margin="20,0,0,0" Padding="10,5" Click="GenerateScrapReportButton_Click"/>
                                </StackPanel>

                                <DataGrid x:Name="ScrapReportDataGrid" Grid.Row="1" Margin="5" IsReadOnly="True" AutoGenerateColumns="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="أمر العمل" Binding="{Binding WorkOrderNumber}" Width="*"/>
                                        <DataGridTextColumn Header="المنتج" Binding="{Binding ProductName}" Width="2*"/>
                                        <DataGridTextColumn Header="الكمية التالفة" Binding="{Binding Quantity}" Width="*"/>
                                        <DataGridTextColumn Header="السبب" Binding="{Binding Reason}" Width="3*"/>
                                        <DataGridTextColumn Header="تاريخ التسجيل" Binding="{Binding Date, StringFormat='d'}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </GroupBox>
                    </TabItem>
                    <!-- *** نهاية التحديث *** -->
                </TabControl>
            </TabItem>

            <!-- التبويب الرابع: تقارير مالية -->
            <TabItem Header="تقارير مالية" FontSize="14">
                <TabControl>
                    <TabItem Header="دفتر الأستاذ العام">
                        <GroupBox Header="دفتر الأستاذ العام" Margin="5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                    <Label Content="الحساب:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="GlAccountComboBox" Width="250" VerticalAlignment="Center" DisplayMemberPath="AccountName" SelectedValuePath="Id"/>
                                    <Label Content="من تاريخ:" VerticalAlignment="Center" Margin="20,0,0,0"/>
                                    <DatePicker x:Name="GlFromDatePicker" Width="120" VerticalAlignment="Center"/>
                                    <Label Content="إلى تاريخ:" VerticalAlignment="Center" Margin="20,0,0,0"/>
                                    <DatePicker x:Name="GlToDatePicker" Width="120" VerticalAlignment="Center"/>
                                    <Button x:Name="GenerateGlReportButton" Content="📊 توليد التقرير" Margin="20,0,0,0" Padding="10,5" Click="GenerateGlReportButton_Click"/>
                                </StackPanel>

                                <DataGrid x:Name="GlReportDataGrid" Grid.Row="1" Margin="5" IsReadOnly="True" AutoGenerateColumns="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="التاريخ" Binding="{Binding Date, StringFormat='d'}" Width="*"/>
                                        <DataGridTextColumn Header="رقم القيد" Binding="{Binding VoucherNumber}" Width="*"/>
                                        <DataGridTextColumn Header="الوصف" Binding="{Binding Description}" Width="3*"/>
                                        <DataGridTextColumn Header="مدين" Binding="{Binding Debit, StringFormat=C}" Width="*"/>
                                        <DataGridTextColumn Header="دائن" Binding="{Binding Credit, StringFormat=C}" Width="*"/>
                                        <DataGridTextColumn Header="الرصيد" Binding="{Binding Balance, StringFormat=C}" Width="*" FontWeight="Bold"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <Grid Grid.Row="2" Margin="5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition/>
                                        <ColumnDefinition/>
                                        <ColumnDefinition/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0">
										<Run Text="الرصيد الافتتاحي: "/>
										<Run x:Name="OpeningBalanceRun" FontWeight="Bold"/>
                                    </TextBlock>
                                    <TextBlock Grid.Column="1">
										<Run Text="إجمالي المدين: "/>
										<Run x:Name="TotalDebitRun" FontWeight="Bold"/>
                                    </TextBlock>
                                    <TextBlock Grid.Column="2">
										<Run Text="إجمالي الدائن: "/>
										<Run x:Name="TotalCreditRun" FontWeight="Bold"/>
                                    </TextBlock>
                                    <TextBlock Grid.Column="3">
										<Run Text="الرصيد الختامي: "/>
										<Run x:Name="ClosingBalanceRun" FontWeight="Bold" Foreground="Blue"/>
                                    </TextBlock>
                                </Grid>
                            </Grid>
                        </GroupBox>
                    </TabItem>

                    <TabItem Header="ميزان المراجعة">
                        <GroupBox Header="ميزان المراجعة" Margin="5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                    <Label Content="ميزان المراجعة في تاريخ:" VerticalAlignment="Center"/>
                                    <DatePicker x:Name="TbDatePicker" Width="150" VerticalAlignment="Center"/>
                                    <Button x:Name="GenerateTbReportButton" Content="📊 توليد الميزان" Margin="20,0,0,0" Padding="10,5" Click="GenerateTbReportButton_Click"/>
                                </StackPanel>

                                <DataGrid x:Name="TbReportDataGrid" Grid.Row="1" Margin="5" IsReadOnly="True" AutoGenerateColumns="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="رقم الحساب" Binding="{Binding AccountNumber}" Width="*"/>
                                        <DataGridTextColumn Header="اسم الحساب" Binding="{Binding AccountName}" Width="3*"/>
                                        <DataGridTextColumn Header="رصيد مدين" Binding="{Binding DebitBalance, StringFormat=C}" Width="*"/>
                                        <DataGridTextColumn Header="رصيد دائن" Binding="{Binding CreditBalance, StringFormat=C}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <Border Grid.Row="2" BorderBrush="Gray" BorderThickness="0,1,0,0" Margin="5" Padding="5">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="1" Text="الإجمالي:" FontWeight="Bold" FontSize="14" HorizontalAlignment="Right"/>
                                        <TextBlock x:Name="TbTotalDebitRun" Grid.Column="2" FontWeight="Bold" FontSize="14" HorizontalAlignment="Right" Foreground="Green"/>
                                        <TextBlock x:Name="TbTotalCreditRun" Grid.Column="3" FontWeight="Bold" FontSize="14" HorizontalAlignment="Right" Foreground="Red"/>
                                    </Grid>
                                </Border>
                            </Grid>
                        </GroupBox>
                    </TabItem>

                    <TabItem Header="قائمة الدخل">
                        <GroupBox Header="قائمة الدخل (الأرباح والخسائر)" Margin="5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                    <Label Content="من تاريخ:" VerticalAlignment="Center"/>
                                    <DatePicker x:Name="IsFromDatePicker" Width="150" VerticalAlignment="Center"/>
                                    <Label Content="إلى تاريخ:" VerticalAlignment="Center" Margin="20,0,0,0"/>
                                    <DatePicker x:Name="IsToDatePicker" Width="150" VerticalAlignment="Center"/>
                                    <Button x:Name="GenerateIsReportButton" Content="📊 توليد القائمة" Margin="20,0,0,0" Padding="10,5" Click="GenerateIsReportButton_Click"/>
                                </StackPanel>

                                <Grid Grid.Row="1" Margin="5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition/>
                                    </Grid.ColumnDefinitions>

                                    <GroupBox Header="الإيرادات" Grid.Column="0" Margin="5">
                                        <DataGrid x:Name="RevenueDataGrid" AutoGenerateColumns="False" IsReadOnly="True" HeadersVisibility="Column">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="الحساب" Binding="{Binding AccountName}" Width="2*"/>
                                                <DataGridTextColumn Header="الرصيد" Binding="{Binding Balance, StringFormat=C}" Width="*"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </GroupBox>

                                    <GroupBox Header="المصروفات" Grid.Column="1" Margin="5">
                                        <DataGrid x:Name="ExpenseDataGrid" AutoGenerateColumns="False" IsReadOnly="True" HeadersVisibility="Column">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="الحساب" Binding="{Binding AccountName}" Width="2*"/>
                                                <DataGridTextColumn Header="الرصيد" Binding="{Binding Balance, StringFormat=C}" Width="*"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </GroupBox>
                                </Grid>

                                <Border Grid.Row="2" Background="LightYellow" Margin="5" Padding="10" CornerRadius="5">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <TextBlock Text="صافي الربح / الخسارة: " FontWeight="Bold" FontSize="16"/>
                                        <TextBlock x:Name="NetProfitLossRun" FontWeight="Bold" FontSize="18"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </GroupBox>
                    </TabItem>

                    <!-- *** بداية التحديث: إضافة قسم الميزانية العمومية *** -->
                    <TabItem Header="الميزانية العمومية">
                        <GroupBox Header="الميزانية العمومية" Margin="5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                    <Label Content="الميزانية في تاريخ:" VerticalAlignment="Center"/>
                                    <DatePicker x:Name="BsDatePicker" Width="150" VerticalAlignment="Center"/>
                                    <Button x:Name="GenerateBsReportButton" Content="📊 توليد الميزانية" Margin="20,0,0,0" Padding="10,5" Click="GenerateBsReportButton_Click"/>
                                </StackPanel>

                                <Grid Grid.Row="1" Margin="5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition/>
                                    </Grid.ColumnDefinitions>

                                    <GroupBox Header="الأصول" Grid.Column="0" Margin="5">
                                        <TreeView x:Name="AssetsTreeView">
                                            <TreeView.ItemTemplate>
                                                <HierarchicalDataTemplate ItemsSource="{Binding SubAccounts}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="{Binding AccountName}" FontWeight="SemiBold"/>
                                                        <TextBlock Text=" : "/>
                                                        <TextBlock Text="{Binding Balance, StringFormat=C}"/>
                                                    </StackPanel>
                                                </HierarchicalDataTemplate>
                                            </TreeView.ItemTemplate>
                                        </TreeView>
                                    </GroupBox>

                                    <StackPanel Grid.Column="1">
                                        <GroupBox Header="الخصوم" Margin="5">
                                            <TreeView x:Name="LiabilitiesTreeView">
                                                <TreeView.ItemTemplate>
                                                    <HierarchicalDataTemplate ItemsSource="{Binding SubAccounts}">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding AccountName}" FontWeight="SemiBold"/>
                                                            <TextBlock Text=" : "/>
                                                            <TextBlock Text="{Binding Balance, StringFormat=C}"/>
                                                        </StackPanel>
                                                    </HierarchicalDataTemplate>
                                                </TreeView.ItemTemplate>
                                            </TreeView>
                                        </GroupBox>
                                        <GroupBox Header="حقوق الملكية" Margin="5">
                                            <TreeView x:Name="EquityTreeView">
                                                <TreeView.ItemTemplate>
                                                    <HierarchicalDataTemplate ItemsSource="{Binding SubAccounts}">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding AccountName}" FontWeight="SemiBold"/>
                                                            <TextBlock Text=" : "/>
                                                            <TextBlock Text="{Binding Balance, StringFormat=C}"/>
                                                        </StackPanel>
                                                    </HierarchicalDataTemplate>
                                                </TreeView.ItemTemplate>
                                            </TreeView>
                                        </GroupBox>
                                    </StackPanel>
                                </Grid>

                                <Border Grid.Row="2" Background="LightCyan" Margin="5" Padding="10" CornerRadius="5">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" HorizontalAlignment="Center">
											<Run Text="إجمالي الأصول: "/>
											<Run x:Name="TotalAssetsRun" FontWeight="Bold" FontSize="16"/>
                                        </TextBlock>
                                        <TextBlock Grid.Column="1" HorizontalAlignment="Center">
											<Run Text="إجمالي الخصوم وحقوق الملكية: "/>
											<Run x:Name="TotalLiabilitiesAndEquityRun" FontWeight="Bold" FontSize="16"/>
                                        </TextBlock>
                                    </Grid>
                                </Border>
                            </Grid>
                        </GroupBox>
                    </TabItem>
                    <!-- *** نهاية التحديث *** -->
                </TabControl>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>